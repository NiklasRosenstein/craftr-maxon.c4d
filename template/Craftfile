# craftr_module(plugin)
#
# Copyright (C) <Year> <Name>
# All rights reserved.

session.path.append(project_dir + '/..')

P = load_module('platform')
c4d = load_module('maxon.c4d', legacy_api=True)

build_dir = join(project_dir, 'build', c4d.build_dir_base)
source_dir = join(project_dir, 'source')

plugin = c4d.cdl(project_dir + '/' + module.identifier)
sources = glob(join(source_dir, '**', '*.cpp'))
includes = [project_dir, join(project_dir, 'include')]
libs = []
implicit_libs = []

# Have any other modules you want to include? Easy.
#
# load_module('my.utils')
# includes += my.utils.includes
# libs += [my.utils.library]

objects = c4d.obj(rmvsuffix(sources))
objects = move(objects, source_dir, join(build_dir, 'obj'))

target('Objects',
  inputs = sources,
  outputs = objects,
  foreach = True,
  command = c4d.compile + c4d.cinc(includes),
  description = 'Building Object File (%%out)',
)

target('Plugin',
  inputs = objects,
  requires = [c4d.library] + libs,
  outputs = plugin,
  command = c4d.link + libs + implicit_libs,
  description = 'Building Plugin File (%%out)',
)
