# craftr_module(plugin)
#
# Copyright (C) <Year> <Name>
# All rights reserved.

from craftr.utils.path import *

P = load_module('platform')

session.path.append(project_dir + '/..')
c4d = session.get_namespace('maxon.c4d')
c4d.legacy_api = False
load_module(c4d)

build_dir = join(project_dir, 'build', c4d.build_dir_base)
source_dir = join(project_dir, 'source')

plugin = c4d.cdl(project_dir + '/myplugin')
sources = glob(join(source_dir, '**', '*.cpp'))
includes = [project_dir]
libs = []

# Have any other modules you want to include? Easy.
#
# load_module('my.utils')
# includes += my.utils.includes
# libs += [my.utils.library]

objects = move(sources, project_dir, join(build_dir, 'obj'), c4d.obj)

target('Objects',
  inputs = sources,
  outputs = objects,
  foreach = True,
  command = c4d.compile + c4d.cinc(includes),
  description = 'Building Object File (%%out)',
)

target('Plugin',
  inputs = objects,
  requires = [c4d.library] + libs,
  outputs = plugin,
  command = c4d.link + libs + implicit_libs,
  description = 'Building Plugin File (%%out)',
)
